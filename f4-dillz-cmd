index.js
const {
  default: makeWASocket,
  useMultiFileAuthState,
  fetchLatestBaileysVersion
} = require("@whiskeysockets/baileys")
const fs = require("fs")

const OWNER = "62895336128088"

let config = {
  botName: "f4_dillz CMD",
  ownerName: "fdill",
  allowedGroups: [],
  welcome: {
    on: true,
    text: "ðŸ”¥ WELCOME TO FAMILY SUNDAã€¡SATSET ðŸ”¥\nWilujeng sumping @user"
  },
  bye: {
    on: true,
    text: "ðŸ‘‹ SELAMAT TINGGAL KACUNGGGG"
  }
}

function saveConfig() {
  fs.writeFileSync("./config.json", JSON.stringify(config, null, 2))
}

async function startBot() {
  const { state, saveCreds } = await useMultiFileAuthState("session")
  const { version } = await fetchLatestBaileysVersion()

  const sock = makeWASocket({
    version,
    auth: state,
    printQRInTerminal: true
  })

  sock.ev.on("creds.update", saveCreds)

  sock.ev.on("group-participants.update", async (anu) => {
    if (!config.allowedGroups.includes(anu.id)) return

    if (anu.action === "add" && config.welcome.on) {
      const user = anu.participants[0]
      await sock.sendMessage(anu.id, {
        text: config.welcome.text.replace("@user", `@${user.split("@")[0]}`),
        mentions: [user]
      })
    }

    if (anu.action === "remove" && config.bye.on) {
      await sock.sendMessage(anu.id, { text: config.bye.text })
    }
  })

  sock.ev.on("messages.upsert", async ({ messages }) => {
    const m = messages[0]
    if (!m.message) return
    if (!m.key.remoteJid.endsWith("@g.us")) return

    const from = m.key.remoteJid
    const sender = m.key.participant
    const text = m.message.conversation || m.message.extendedTextMessage?.text
    if (!text) return

    if (!config.allowedGroups.includes(from)) return

    const isOwner = sender && sender.includes(OWNER)

    if (text === "!addgroup" && isOwner) {
      config.allowedGroups.push(from)
      saveConfig()
      return sock.sendMessage(from, { text: "âœ… Grup ditambahkan" })
    }

    if (text === "!tagall") {
      if (!isOwner) {
        return sock.sendMessage(from, { text: "KAMU BUKAN OWNER!!" })
      }
      const meta = await sock.groupMetadata(from)
      const members = meta.participants.map(p => p.id)
      return sock.sendMessage(from, {
        text: members.map(u => `@${u.split("@")[0]}`).join(" "),
        mentions: members
      })
    }
  })
}

startBot()
